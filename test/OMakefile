
TESTS=$(glob test-*.sh)
TEST_FLAGS=$(replacesuffixes .sh,.flag,$(TESTS))

.PHONY: test
test: $(TEST_FLAGS)

setenv(PATH,$"$(absname $(dirof $(GITBUG))):$(getenv PATH)")
foreach(T, $(TESTS))
	BASE=$(removesuffix $T)
	DIR=$(dir $(BASE).dir)
	$(BASE).flag: $T $(GITBUG)
		rm -rf $(DIR)
		mkdir $(DIR)
		(cd $(DIR) && ../$<)
		touch $@
